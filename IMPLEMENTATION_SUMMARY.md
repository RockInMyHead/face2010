# –†–µ–∑—é–º–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–π –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –î–µ—Ç–µ–∫—Ü–∏—è –∏ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ª–∏—Ü
- ‚úÖ **InsightFace (buffalo_l)** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–µ—Ç–µ–∫—Ç–æ—Ä —Å 5 –∫–ª—é—á–µ–≤—ã–º–∏ —Ç–æ—á–∫–∞–º–∏
- ‚úÖ –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ª–∏—Ü –ø–æ –º–µ–∂–∑—Ä–∞—á–∫–æ–≤–æ–º—É —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é —á–µ—Ä–µ–∑ `align_face_5points()`
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ confidence (>0.9) –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–º—É —Ä–∞–∑–º–µ—Ä—É

### 2. –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- ‚úÖ **Blur detection** —á–µ—Ä–µ–∑ Variance of Laplacian (`calculate_blur_score()`)
- ‚úÖ **–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞** (`calculate_face_quality()`):
  - –†–∞–∑–º–µ—Ä –ª–∏—Ü–∞ (30% –≤–µ—Å–∞)
  - –†–µ–∑–∫–æ—Å—Ç—å/blur (50% –≤–µ—Å–∞)
  - –Ø—Ä–∫–æ—Å—Ç—å –∏ –∫–æ–Ω—Ç—Ä–∞—Å—Ç (20% –≤–µ—Å–∞)
- ‚úÖ –û—Ç–±—Ä–∞—Å—ã–≤–∞–Ω–∏–µ –Ω–∏–∑–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∫–∞–¥—Ä–æ–≤ (quality < 0.3)

### 3. SOTA —ç–º–±–µ–¥–¥–∏–Ω–≥–∏
- ‚úÖ **ArcFace/InsightFace** (w600k_r50) - 512D —ç–º–±–µ–¥–¥–∏–Ω–≥–∏
- ‚úÖ L2-–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –∫–æ—Å–∏–Ω—É—Å–Ω–æ–≥–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
- ‚úÖ –¢–æ—á–Ω–æ—Å—Ç—å >99% –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö benchmark

### 4. Test-Time Augmentation (TTA)
- ‚úÖ –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π flip –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- ‚úÖ –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ª–∏—Ü –ø–æ IoU (Intersection over Union)
- ‚úÖ –£—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ –∏ re-–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
- ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä `apply_tta`

### 5. –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ-–≤–∑–≤–µ—à–µ–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã
- ‚úÖ –ü—Ä–∏—Å–≤–æ–µ–Ω–∏–µ –≤–µ—Å–æ–≤ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–∞–∂–¥–æ–º—É —ç–º–±–µ–¥–¥–∏–Ω–≥—É (0.0-1.0)
- ‚úÖ –í–∑–≤–µ—à–∏–≤–∞–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –ø–µ—Ä–µ–¥ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–µ–π
- ‚úÖ L2-–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤–∑–≤–µ—à–µ–Ω–Ω—ã—Ö –≤–µ–∫—Ç–æ—Ä–æ–≤

### 6. k-reciprocal re-ranking
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `k_reciprocal_rerank()` –¥–ª—è –≥—Ä–∞—Ñ–∞ —Å—Ö–æ–¥—Å—Ç–≤–∞
- ‚úÖ –£—Å–∏–ª–µ–Ω–∏–µ —Å–≤—è–∑–µ–π –º–µ–∂–¥—É –≤–∑–∞–∏–º–Ω—ã–º–∏ k-–±–ª–∏–∂–∞–π—à–∏–º–∏ —Å–æ—Å–µ–¥—è–º–∏ (boost 1.2x)
- ‚úÖ –£–º–µ—Ä–µ–Ω–Ω–æ–µ —É—Å–∏–ª–µ–Ω–∏–µ –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö —Å–æ—Å–µ–¥–µ–π (boost 1.1x)
- ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä k=3 (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π)

### 7. Spectral Clustering
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ—Å–∏–Ω—É—Å–Ω–æ–π –º–∞—Ç—Ä–∏—Ü—ã —Å—Ö–æ–¥—Å—Ç–≤–∞
- ‚úÖ –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∞—Ñ—Ñ–∏–Ω–∏—Ç–∏-–º–∞—Ç—Ä–∏—Ü—ã —Å –æ–±–Ω—É–ª–µ–Ω–∏–µ–º –¥–∏–∞–≥–æ–Ω–∞–ª–∏
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —á–∏—Å–ª–∞ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤** —á–µ—Ä–µ–∑ eigenvalue gap –∞–Ω–∞–ª–∏–∑
- ‚úÖ Normalized cuts —Å `assign_labels='kmeans'`
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: 2 ‚â§ n_clusters ‚â§ N/2

### 8. –ü–æ—Å—Ç-–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
- ‚úÖ –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ü–µ–Ω—Ç—Ä–æ–∏–¥–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–Ω—É—Ç—Ä–∏–∫–ª–∞—Å—Ç–µ—Ä–Ω—ã—Ö —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π (–ø–æ—Ä–æ–≥ 0.35)
- ‚úÖ **–ü–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ outliers** –∫ –±–ª–∏–∂–∞–π—à–µ–º—É –≤–∞–ª–∏–¥–Ω–æ–º—É –∫–ª–∞—Å—Ç–µ—Ä—É
- ‚úÖ **–°–ª–∏—è–Ω–∏–µ –æ–¥–∏–Ω–æ—á–Ω—ã—Ö –∫–ª–∞—Å—Ç–µ—Ä–æ–≤** –µ—Å–ª–∏ —Å—Ö–æ–¥—Å—Ç–≤–æ —Å –¥—Ä—É–≥–∏–º > –ø–æ—Ä–æ–≥–∞
- ‚úÖ –ü–æ–º–µ—Ç–∫–∞ noise —Ç–æ—á–µ–∫ (-1) –µ—Å–ª–∏ –Ω–µ –ø–æ–¥—Ö–æ–¥—è—Ç –Ω–∏ –∫ –æ–¥–Ω–æ–º—É –∫–ª–∞—Å—Ç–µ—Ä—É

### 9. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π
- ‚úÖ –§–∞–π–ª `cluster_advanced.py` —Å –ø–æ–ª–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `main.py` —á–µ—Ä–µ–∑ —Ñ–ª–∞–≥ `USE_ADVANCED_CLUSTERING`
- ‚úÖ Fallback –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º API
- ‚úÖ Progress callback –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### 10. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `ADVANCED_CLUSTERING_GUIDE.md`
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã: `test_advanced_clustering.py`
- ‚úÖ –°–∫—Ä–∏–ø—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏: `install_advanced.sh` –∏ `install_advanced.cmd`
- ‚úÖ –§–∞–π–ª –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π: `requirements-advanced.txt`

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–í—Å–µ 6 —Ç–µ—Å—Ç–æ–≤ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã:
- ‚úÖ –ò–º–ø–æ—Ä—Ç—ã –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è InsightFace
- ‚úÖ –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- ‚úÖ k-reciprocal re-ranking
- ‚úÖ Spectral Clustering
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å main.py

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–π –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏:
```bash
export USE_ADVANCED_CLUSTERING=true
python main.py
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (main.py, —Å—Ç—Ä–æ–∫–∞ 323-330):
```python
clustering_func = functools.partial(
    build_plan_advanced,
    input_dir=path,
    min_face_confidence=0.9,      # –ü–æ—Ä–æ–≥ –¥–µ—Ç–µ–∫—Ü–∏–∏
    apply_tta=True,                # TTA –≤–∫–ª/–≤—ã–∫–ª
    use_gpu=False,                 # GPU –≤–∫–ª/–≤—ã–∫–ª
    progress_callback=progress_callback,
    include_excluded=include_excluded
)
```

## üìà –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π

| –ú–µ—Ç—Ä–∏–∫–∞ | –¢–µ–∫—É—â–∞—è (HDBSCAN) | –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è |
|---------|-------------------|-------------|
| –î–µ—Ç–µ–∫—Ç–æ—Ä | HOG/CNN (dlib) | InsightFace SCRFD |
| –≠–º–±–µ–¥–¥–∏–Ω–≥–∏ | face_recognition 128D | ArcFace 512D |
| TTA | ‚ùå | ‚úÖ (flip) |
| –ö–∞—á–µ—Å—Ç–≤–æ | –ë–∞–∑–æ–≤–æ–µ | –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ |
| Re-ranking | ‚ùå | ‚úÖ (k-reciprocal) |
| –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è | HDBSCAN+DBSCAN | Spectral |
| –ê–≤—Ç–æ n_clusters | ‚úÖ (–ø–ª–æ—Ç–Ω–æ—Å—Ç—å) | ‚úÖ (eigenvalue) |

## üîÆ –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (–Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ):
- [ ] **Ensemble –º–æ–¥–µ–ª–µ–π**: ArcFace + MagFace –¥–ª—è quality-aware –≤–µ—Å–æ–≤
- [ ] **5-crop TTA**: –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞—É–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ –æ–≤–∞–ª—É –ª–∏—Ü–∞
- [ ] **RetinaFace –¥–µ—Ç–µ–∫—Ü–∏—è**: –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ InsightFace
- [ ] **Adaptive thresholding**: –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–æ—Ä–æ–≥–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- [ ] **Batch processing**: –ø–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ GPU –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è
- [ ] **Incremental clustering**: –¥–ª—è –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö –¥–∞—Ç–∞—Å–µ—Ç–æ–≤

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏:
```bash
export USE_ADVANCED_CLUSTERING=true
# –í main.py —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å:
# min_face_confidence=0.95
# apply_tta=True
# use_gpu=True (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
```

### –î–ª—è –±–∞–ª–∞–Ω—Å–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏/—Ç–æ—á–Ω–æ—Å—Ç–∏:
```bash
export USE_ADVANCED_CLUSTERING=true
# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
# apply_tta=True
# use_gpu=False
```

### –î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏:
```bash
# –ù–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å USE_ADVANCED_CLUSTERING
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é HDBSCAN –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—é
```

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞:
```bash
# macOS/Linux
chmod +x install_advanced.sh
./install_advanced.sh

# Windows
install_advanced.cmd
```

### –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞:
```bash
pip install -r requirements-advanced.txt

# –î–ª—è GPU (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
pip install onnxruntime-gpu torch torchvision
```

## ‚úÖ –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞

–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã. –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.

**–í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** ~2 —á–∞—Å–∞  
**–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~800 (cluster_advanced.py)  
**–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏:** 100% (6/6)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

