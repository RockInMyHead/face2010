@echo off
echo ๐ ะะฐะฟััะบ ะฟัะพะตะบัะฐ FaceSort ะฝะฐ Windows...
echo ๐ ะะฐะฑะพัะฐั ะดะธัะตะบัะพัะธั: %cd%
python --version
echo.

echo ๐ฆ ะัะพะฒะตััะตะผ ะฒะธัััะฐะปัะฝะพะต ะพะบััะถะตะฝะธะต...
if not exist venv (
    echo ๐ง ะกะพะทะดะฐะตะผ ะฒะธัััะฐะปัะฝะพะต ะพะบััะถะตะฝะธะต...
    python -m venv venv
    if errorlevel 1 (
        echo โ ะัะธะฑะบะฐ ัะพะทะดะฐะฝะธั ะฒะธัััะฐะปัะฝะพะณะพ ะพะบััะถะตะฝะธั
        pause
        exit /b 1
    )
    echo โ ะะธัััะฐะปัะฝะพะต ะพะบััะถะตะฝะธะต ัะพะทะดะฐะฝะพ
) else (
    echo โ ะะธัััะฐะปัะฝะพะต ะพะบััะถะตะฝะธะต ะฝะฐะนะดะตะฝะพ
)

echo ๐ ะะบัะธะฒะธััะตะผ ะฒะธัััะฐะปัะฝะพะต ะพะบััะถะตะฝะธะต...
call venv\Scripts\activate.bat
if errorlevel 1 (
    echo โ ะัะธะฑะบะฐ ะฐะบัะธะฒะฐัะธะธ ะฒะธัััะฐะปัะฝะพะณะพ ะพะบััะถะตะฝะธั
    pause
    exit /b 1
)
echo โ ะะธัััะฐะปัะฝะพะต ะพะบััะถะตะฝะธะต ะฐะบัะธะฒะธัะพะฒะฐะฝะพ
echo.

echo ๐ฆ ะัะพะฒะตััะตะผ ะทะฐะฒะธัะธะผะพััะธ...
python -c "import fastapi, uvicorn, PIL, cv2, insightface, faiss" 2>nul
if errorlevel 1 (
    echo โ ะะตะบะพัะพััะต ะทะฐะฒะธัะธะผะพััะธ ะฝะต ัััะฐะฝะพะฒะปะตะฝั.
    echo ๐ง ะฃััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะทะฐะฒะธัะธะผะพััะธ...
    pip install --upgrade pip
    pip install -r requirements-win.txt
    if errorlevel 1 (
        echo โ ะัะธะฑะบะฐ ัััะฐะฝะพะฒะบะธ ะทะฐะฒะธัะธะผะพััะตะน
        pause
        exit /b 1
    )
    echo โ ะะฐะฒะธัะธะผะพััะธ ัััะฐะฝะพะฒะปะตะฝั
) else (
    echo โ ะัะฝะพะฒะฝัะต ะทะฐะฒะธัะธะผะพััะธ ัััะฐะฝะพะฒะปะตะฝั
)
echo.

echo ๐ ะััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะฟัะตะดัะดััะธะต ะฟัะพัะตััั...
taskkill /f /im python.exe /fi "WINDOWTITLE eq main.py*" >nul 2>&1
taskkill /f /im python.exe /fi "IMAGENAME eq python.exe" /fi "MEMUSAGE gt 100000" >nul 2>&1
timeout /t 2 >nul

echo ๐ ะะฐะฟััะบะฐะตะผ ัะตัะฒะตั FaceSort...
start "FaceSort Server" python main.py

echo โ ะกะตัะฒะตั ะทะฐะฟััะตะฝ!
echo ๐ URL: http://localhost:8000
echo ๐ ะัะพะฒะตัะบะฐ ัะตัะตะท 5 ัะตะบัะฝะด...
timeout /t 5 >nul

echo ๐ ะะปั ะพััะฐะฝะพะฒะบะธ ัะตัะฒะตัะฐ ะทะฐะบัะพะนัะต ะพะบะฝะพ ะบะพะผะฐะฝะดะฝะพะน ัััะพะบะธ ะธะปะธ ะฝะฐะถะผะธัะต Ctrl+C
echo ๐ฏ ะัะบัะพะนัะต http://localhost:8000 ะฒ ะฑัะฐัะทะตัะต
pause
